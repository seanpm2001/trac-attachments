Index: configure
===================================================================
--- configure	(revision 47276)
+++ configure	(working copy)
@@ -1,5 +1,5 @@
 #! /bin/sh
-# From configure.in Id: configure.in 47230 2007-07-08 07:04:38Z VS .
+# From configure.in Id: configure.in 47255 2007-07-09 10:12:51Z VS .
 # Guess values for system-dependent variables and create Makefiles.
 # Generated by GNU Autoconf 2.61 for wxWidgets 2.9.0.
 #
@@ -726,8 +726,10 @@
 CAIRO_LIBS
 GST_CFLAGS
 GST_LIBS
-CORE_BASE_LIBS
-CORE_GUI_LIBS
+ALL_WX_LIBS
+BUILT_WX_LIBS
+STD_BASE_LIBS
+STD_GUI_LIBS
 wxUSE_ZLIB
 wxUSE_REGEX
 wxUSE_EXPAT
@@ -22970,11 +22972,13 @@
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-#include <stdio.h>
+#include <sys/types.h> /* for off_t */
+     #include <stdio.h>
 int
 main ()
 {
-return fseeko (stdin, 0, 0) && (fseeko) (stdin, 0, 0);
+int (*fp) (FILE *, off_t, int) = fseeko;
+     return fseeko (stdin, 0, 0) && fp (stdin, 0, 0);
   ;
   return 0;
 }
@@ -23014,11 +23018,13 @@
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
 #define _LARGEFILE_SOURCE 1
-#include <stdio.h>
+#include <sys/types.h> /* for off_t */
+     #include <stdio.h>
 int
 main ()
 {
-return fseeko (stdin, 0, 0) && (fseeko) (stdin, 0, 0);
+int (*fp) (FILE *, off_t, int) = fseeko;
+     return fseeko (stdin, 0, 0) && fp (stdin, 0, 0);
   ;
   return 0;
 }
@@ -46095,34 +46101,53 @@
 
 
 
-CORE_BASE_LIBS="net base"
-CORE_GUI_LIBS="adv core"
+STD_BASE_LIBS="base"
+STD_GUI_LIBS=""
+BUILT_WX_LIBS="base"
+ALL_WX_LIBS="xrc stc gl media dbgrid qa html adv core odbc xml net base"
 
-if test "$wxUSE_XML" = "yes" ; then
-    CORE_BASE_LIBS="xml $CORE_BASE_LIBS"
+if test "$wxUSE_SOCKETS" = "yes" ; then
+    STD_BASE_LIBS="net $STD_BASE_LIBS"
+    BUILT_WX_LIBS="net $BUILT_WX_LIBS"
 fi
 if test "$wxUSE_ODBC" != "no" ; then
-    CORE_BASE_LIBS="odbc $CORE_BASE_LIBS"
-    CORE_GUI_LIBS="dbgrid $CORE_GUI_LIBS"
+    BUILT_WX_LIBS="odbc $BUILT_WX_LIBS"
 fi
-if test "$wxUSE_HTML" = "yes" ; then
-    CORE_GUI_LIBS="html $CORE_GUI_LIBS"
+if test "$wxUSE_XML" = "yes" ; then
+    STD_BASE_LIBS="xml $STD_BASE_LIBS"
+    BUILT_WX_LIBS="xml $BUILT_WX_LIBS"
 fi
-if test "$wxUSE_DEBUGREPORT" = "yes" ; then
-    CORE_GUI_LIBS="qa $CORE_GUI_LIBS"
-fi
-if test "$wxUSE_XRC" = "yes" ; then
-    CORE_GUI_LIBS="xrc $CORE_GUI_LIBS"
-fi
-if test "$wxUSE_AUI" = "yes" ; then
-    CORE_GUI_LIBS="aui $CORE_GUI_LIBS"
-fi
-if test "$wxUSE_STC" = "yes" ; then
-    CORE_GUI_LIBS="stc $CORE_GUI_LIBS"
-fi
 
-if test "$wxUSE_GUI" != "yes"; then
-    CORE_GUI_LIBS=""
+if test "$wxUSE_GUI" = "yes"; then
+    STD_GUI_LIBS="adv core"
+
+    if test "$wxUSE_DEBUGREPORT" = "yes" ; then
+        STD_GUI_LIBS="qa $STD_GUI_LIBS"
+        BUILT_WX_LIBS="qa $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_ODBC" != "no" ; then
+        BUILT_WX_LIBS="dbgrid $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_HTML" = "yes" ; then
+        STD_GUI_LIBS="html $STD_GUI_LIBS"
+        BUILT_WX_LIBS="html $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_MEDIACTRL" = "yes" ; then
+        BUILT_WX_LIBS="media $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_OPENGL" = "yes" ; then
+        BUILT_WX_LIBS="gl $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_AUI" = "yes" ; then
+        BUILT_WX_LIBS="aui $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_STC" = "yes" ; then
+        BUILT_WX_LIBS="stc $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_XRC" = "yes" ; then
+        STD_GUI_LIBS="xrc $STD_GUI_LIBS"
+        BUILT_WX_LIBS="xrc $BUILT_WX_LIBS"
+    fi
 fi
 
 
@@ -46130,6 +46155,8 @@
 
 
 
+
+
 if test "$wxUSE_MAC" = 1 ; then
     if test "$wxUSE_SOUND" = "yes" || test "$wxUSE_MEDIACTRL" = "yes"; then
         if test "$USE_DARWIN" = 1; then
@@ -50675,8 +50702,10 @@
 CAIRO_LIBS!$CAIRO_LIBS$ac_delim
 GST_CFLAGS!$GST_CFLAGS$ac_delim
 GST_LIBS!$GST_LIBS$ac_delim
-CORE_BASE_LIBS!$CORE_BASE_LIBS$ac_delim
-CORE_GUI_LIBS!$CORE_GUI_LIBS$ac_delim
+ALL_WX_LIBS!$ALL_WX_LIBS$ac_delim
+BUILT_WX_LIBS!$BUILT_WX_LIBS$ac_delim
+STD_BASE_LIBS!$STD_BASE_LIBS$ac_delim
+STD_GUI_LIBS!$STD_GUI_LIBS$ac_delim
 wxUSE_ZLIB!$wxUSE_ZLIB$ac_delim
 wxUSE_REGEX!$wxUSE_REGEX$ac_delim
 wxUSE_EXPAT!$wxUSE_EXPAT$ac_delim
@@ -50757,8 +50786,6 @@
 BK_MAKE_PCH!$BK_MAKE_PCH$ac_delim
 COND_BUILD_DEBUG!$COND_BUILD_DEBUG$ac_delim
 COND_BUILD_DEBUG_DEBUG_FLAG_DEFAULT!$COND_BUILD_DEBUG_DEBUG_FLAG_DEFAULT$ac_delim
-COND_BUILD_DEBUG_DEBUG_INFO_DEFAULT!$COND_BUILD_DEBUG_DEBUG_INFO_DEFAULT$ac_delim
-COND_BUILD_DEBUG_UNICODE_0!$COND_BUILD_DEBUG_UNICODE_0$ac_delim
 _ACEOF
 
   if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 97; then
@@ -50800,6 +50827,8 @@
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   cat >conf$$subs.sed <<_ACEOF
+COND_BUILD_DEBUG_DEBUG_INFO_DEFAULT!$COND_BUILD_DEBUG_DEBUG_INFO_DEFAULT$ac_delim
+COND_BUILD_DEBUG_UNICODE_0!$COND_BUILD_DEBUG_UNICODE_0$ac_delim
 COND_BUILD_DEBUG_UNICODE_1!$COND_BUILD_DEBUG_UNICODE_1$ac_delim
 COND_BUILD_RELEASE!$COND_BUILD_RELEASE$ac_delim
 COND_BUILD_RELEASE_DEBUG_INFO_DEFAULT!$COND_BUILD_RELEASE_DEBUG_INFO_DEFAULT$ac_delim
@@ -50895,8 +50924,6 @@
 COND_SHARED_1_USE_XRC_1!$COND_SHARED_1_USE_XRC_1$ac_delim
 COND_TOOLKIT_!$COND_TOOLKIT_$ac_delim
 COND_TOOLKIT_COCOA!$COND_TOOLKIT_COCOA$ac_delim
-COND_TOOLKIT_COCOA_USE_GUI_1!$COND_TOOLKIT_COCOA_USE_GUI_1$ac_delim
-COND_TOOLKIT_COCOA_USE_GUI_1_WXUNIV_0!$COND_TOOLKIT_COCOA_USE_GUI_1_WXUNIV_0$ac_delim
 _ACEOF
 
   if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 97; then
@@ -50938,6 +50965,8 @@
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   cat >conf$$subs.sed <<_ACEOF
+COND_TOOLKIT_COCOA_USE_GUI_1!$COND_TOOLKIT_COCOA_USE_GUI_1$ac_delim
+COND_TOOLKIT_COCOA_USE_GUI_1_WXUNIV_0!$COND_TOOLKIT_COCOA_USE_GUI_1_WXUNIV_0$ac_delim
 COND_TOOLKIT_DFB!$COND_TOOLKIT_DFB$ac_delim
 COND_TOOLKIT_DFB_USE_GUI_1!$COND_TOOLKIT_DFB_USE_GUI_1$ac_delim
 COND_TOOLKIT_GTK!$COND_TOOLKIT_GTK$ac_delim
@@ -51033,8 +51062,6 @@
 EXE_LINKER!$EXE_LINKER$ac_delim
 GUIDIST!$GUIDIST$ac_delim
 DISTDIR!$DISTDIR$ac_delim
-SAMPLES_SUBDIRS!$SAMPLES_SUBDIRS$ac_delim
-LDFLAGS_GL!$LDFLAGS_GL$ac_delim
 _ACEOF
 
   if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 97; then
@@ -51076,6 +51103,8 @@
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   cat >conf$$subs.sed <<_ACEOF
+SAMPLES_SUBDIRS!$SAMPLES_SUBDIRS$ac_delim
+LDFLAGS_GL!$LDFLAGS_GL$ac_delim
 OPENGL_LIBS!$OPENGL_LIBS$ac_delim
 DMALLOC_LIBS!$DMALLOC_LIBS$ac_delim
 WX_VERSION_TAG!$WX_VERSION_TAG$ac_delim
@@ -51093,7 +51122,7 @@
 LTLIBOBJS!$LTLIBOBJS$ac_delim
 _ACEOF
 
-  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 15; then
+  if test `sed -n "s/.*$ac_delim\$/X/p" conf$$subs.sed | grep -c X` = 17; then
     break
   elif $ac_last_try; then
     { { echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
Index: docs/tech/tn0016.txt
===================================================================
--- docs/tech/tn0016.txt	(revision 47276)
+++ docs/tech/tn0016.txt	(working copy)
@@ -119,7 +119,7 @@
 The Windows resource specification should use the central .rc file:
 
         <win32-res>../sample.rc</win32-res>
-        
+
 Run bakefile_gen in $(wx)/build/bakefiles to regenerate the bakefiles.
 
 Finally commit $(wx)/build/bakefiles/make_dist.mk and all the other modified files.
@@ -149,7 +149,7 @@
      Finally, define FOO_SRC and FOO_HDR to contain both
      FOO_PLATFORM_{SRC,HDR} and FOO_{SRC,HDR} (see NET_SRC definition for an
      example).
-   * Add FOO_HDR to ALL_GUI_HEADERS or ALL_BASE_HEADERS. 
+   * Add FOO_HDR to ALL_GUI_HEADERS or ALL_BASE_HEADERS.
    * If wxFoo is wxBase library (doesn't use GUI), add FOO_SRC to
      ALL_BASE_SOURCES.
 
@@ -181,8 +181,8 @@
 
 f) Update configure.in and wx-config.in to contain information about
    the library and needed linker flags:
-   * Add "foo" to either CORE_BASE_LIBS or CORE_GUI_LIBS in configure.in so
-     that wxFoo is not treated as contrib library in monolithic build.
+   * Add "foo" to either STD_BASE_LIBS or STD_GUI_LIBS in configure.in if
+     wxFoo is not to be treated as contrib library in monolithic build.
    * If wxFoo links against additional libraries, add necessary linker
      flags and libraries to ldflags_foo and ldlibs_foo variables in
      wx-config.in (both are optional).
Index: configure.in
===================================================================
--- configure.in	(revision 47276)
+++ configure.in	(working copy)
@@ -1487,7 +1487,7 @@
 
 dnl ar command
 dnl   defines AR with the appropriate command
-dnl 
+dnl
 dnl For Sun CC AC_BAKEFILE below sets AR to the compiler itself.
 if test "x$SUNCXX" != xyes; then
     AC_CHECK_TOOL(AR, ar)
@@ -5048,7 +5048,7 @@
 dnl check for uname (POSIX) and gethostname (BSD)
 WX_CHECK_FUNCS(uname,,,[#include <sys/utsname.h>])
 if test "$wx_cv_func_uname" != yes; then
-    WX_CHECK_FUNCS(gethostname)  
+    WX_CHECK_FUNCS(gethostname)
 fi
 
 WX_CHECK_FUNCS(strtok_r, [], [], [#define _REENTRANT])
@@ -6426,7 +6426,7 @@
                        wx_cv_type_getsockopt5,
             [
                 dnl Note that the rules for compatibility of pointers
-                dnl are somewhat different between C and C++, so code 
+                dnl are somewhat different between C and C++, so code
                 dnl that fails in C++ may not even give a warning about
                 dnl converting between incompatible pointer types in C.
                 dnl So this test needs to be done in C++ mode.
@@ -7561,38 +7561,59 @@
 dnl define variables with all built libraries for wx-config
 dnl ---------------------------------------------------------------------------
 
-CORE_BASE_LIBS="net base"
-CORE_GUI_LIBS="adv core"
+STD_BASE_LIBS="base"
+STD_GUI_LIBS=""
+BUILT_WX_LIBS="base"
+ALL_WX_LIBS="xrc stc gl media dbgrid qa html adv core odbc xml net base"
 
-if test "$wxUSE_XML" = "yes" ; then
-    CORE_BASE_LIBS="xml $CORE_BASE_LIBS"
+if test "$wxUSE_SOCKETS" = "yes" ; then
+    STD_BASE_LIBS="net $STD_BASE_LIBS"
+    BUILT_WX_LIBS="net $BUILT_WX_LIBS"
 fi
 if test "$wxUSE_ODBC" != "no" ; then
-    CORE_BASE_LIBS="odbc $CORE_BASE_LIBS"
-    CORE_GUI_LIBS="dbgrid $CORE_GUI_LIBS"
+    BUILT_WX_LIBS="odbc $BUILT_WX_LIBS"
 fi
-if test "$wxUSE_HTML" = "yes" ; then
-    CORE_GUI_LIBS="html $CORE_GUI_LIBS"
+if test "$wxUSE_XML" = "yes" ; then
+    STD_BASE_LIBS="xml $STD_BASE_LIBS"
+    BUILT_WX_LIBS="xml $BUILT_WX_LIBS"
 fi
-if test "$wxUSE_DEBUGREPORT" = "yes" ; then
-    CORE_GUI_LIBS="qa $CORE_GUI_LIBS"
-fi
-if test "$wxUSE_XRC" = "yes" ; then
-    CORE_GUI_LIBS="xrc $CORE_GUI_LIBS"
-fi
-if test "$wxUSE_AUI" = "yes" ; then
-    CORE_GUI_LIBS="aui $CORE_GUI_LIBS"
-fi
-if test "$wxUSE_STC" = "yes" ; then
-    CORE_GUI_LIBS="stc $CORE_GUI_LIBS"
-fi
 
-if test "$wxUSE_GUI" != "yes"; then
-    CORE_GUI_LIBS=""
+if test "$wxUSE_GUI" = "yes"; then
+    STD_GUI_LIBS="adv core"
+
+    if test "$wxUSE_DEBUGREPORT" = "yes" ; then
+        STD_GUI_LIBS="qa $STD_GUI_LIBS"
+        BUILT_WX_LIBS="qa $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_ODBC" != "no" ; then
+        BUILT_WX_LIBS="dbgrid $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_HTML" = "yes" ; then
+        STD_GUI_LIBS="html $STD_GUI_LIBS"
+        BUILT_WX_LIBS="html $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_MEDIACTRL" = "yes" ; then
+        BUILT_WX_LIBS="media $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_OPENGL" = "yes" ; then
+        BUILT_WX_LIBS="gl $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_AUI" = "yes" ; then
+        BUILT_WX_LIBS="aui $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_STC" = "yes" ; then
+        BUILT_WX_LIBS="stc $BUILT_WX_LIBS"
+    fi
+    if test "$wxUSE_XRC" = "yes" ; then
+        STD_GUI_LIBS="xrc $STD_GUI_LIBS"
+        BUILT_WX_LIBS="xrc $BUILT_WX_LIBS"
+    fi
 fi
 
-AC_SUBST(CORE_BASE_LIBS)
-AC_SUBST(CORE_GUI_LIBS)
+AC_SUBST(ALL_WX_LIBS)
+AC_SUBST(BUILT_WX_LIBS)
+AC_SUBST(STD_BASE_LIBS)
+AC_SUBST(STD_GUI_LIBS)
 
 dnl ---------------------------------------------------------------------------
 dnl Output the makefiles and such from the results found above
Index: wx-config.in
===================================================================
--- wx-config.in	(revision 47276)
+++ wx-config.in	(working copy)
@@ -47,8 +47,9 @@
            [--list] [--selected-config] [--host=HOST] [--toolkit=TOOLKIT]
 	   [--universal[=yes|no]] [--unicode[=yes|no]] [--debug[=yes|no]]
 	   [--static[=yes|no]] [--version[=VERSION]] [--basename] [--cc]
-	   [--cppflags] [--cflags] [--cxxflags] [--rescomp] [--libs] [--cxx]
-	   [--ld] [--linkdeps] [--utility=UTIL] [LIB ...] 
+	   [--cppflags] [--cflags] [--cxxflags] [--rescomp] [--cxx]
+	   [--linkdeps] [--ld] [--utility=UTIL]
+	   [--libs [LIBS...]] [--optional-libs [LIBS...]]
 
     wx-config returns information about the wxWidgets libraries available on
   your system.  It may be used to retrieve the information required to build
@@ -63,11 +64,16 @@
   of UTIL to use with the selected build. The --linkdeps option returns only
   static libraries for your makefile link rule dependencies.
 
-    Optional LIB arguments (comma or space separated) may be used to specify
-  the wxWidgets libraries that  you wish  to use.  The magic "std" label may
-  be used to import all libraries that would be used by default if none were
-  specified explicitly, e.g. wx-config --libs core,base.
+    The LIBS arguments (comma or space separated) may be used to specify the
+  wxWidgets libraries that  you wish to use. The "std" label may be used  to
+  import all libraries that would be used by default if none were  specified
+  explicitly, e.g. wx-config --libs core,base. The "all" label may  be  used
+  to  import  all libraries that have been compiled which are shown  in  the
+  list  below.  The  --optional-libs parameter should be followed by  a list
+  of  libs that should be linked to, but only if they are available.
 
+  Available libs are : @BUILT_WX_LIBS@
+
 EOF
 
     exit $1
@@ -117,6 +123,7 @@
                          rescomp
                          rezflags
                          libs
+                         optional_libs
                          linkdeps
                          cc cxx ld
                          gl_libs"
@@ -268,8 +275,17 @@
         ;;
 
     *)
-        # FIXME Surely we can validate the parameters too ...
-        input_parameters="${input_parameters:+$input_parameters }$arg"
+        # We validate the parameters later ...
+        if [ "$_name" = "libs" ]
+        then
+            libs_parameters="${libs_parameters:+$libs_parameters }$arg"
+        elif [ "$_name" = "optional_libs" ]
+        then
+            optional_libs_parameters="${optional_libs_parameters:+$optional_libs_parameters }$arg"
+        else
+            # These are unattached args and signify an error
+            input_parameters="${input_parameters:+$input_parameters }$arg"
+        fi
         continue
         ;;
   esac
@@ -286,12 +302,19 @@
 check_yesno_option debug debugtype debug release
 check_yesno_option static linkage '-static'
 
+# Display error for unknown input parameters
+if [ $input_parameters ]; then
+    echo "Extra unknown input parameters : $input_parameters"
+    exit 1
+fi
 
 # Dump everything we just read in debug mode.
 if [ -n "$WXDEBUG" ]; then
 
     decho
-    decho "  input parameters  = $input_parameters"
+    decho "  input parameters          = $input_parameters"
+    decho "  libs parameters           = $libs_parameters"
+    decho "  optional-libs parameters  = $optional_libs_parameters"
     decho "  input options     = $input_options"
     for i in $input_options; do
         decho "    $i = `eval echo \"\\\$input_option_$i\"`"
@@ -510,7 +533,7 @@
                 for d in `find_eligible_delegates "$_mask"`; do
                     decho "  ${_fbd_indent}    $d"
                 done
-            fi 
+            fi
 
             count_delegates "$_mask"
             _still_eligible=$?
@@ -664,7 +687,7 @@
             echo "  Specification matches legacy config: $_last_chance"
 
         else
-        
+
             cat <<-EOF
 	  No config found to match: $config_spec
 	  in $wxconfdir
@@ -763,7 +786,7 @@
                     --rezflags|--inplace)
                         _legacy_args="$_legacy_args $arg"
                         ;;
-                    
+
                     --static|--static=y*|--static=Y*)
                         _legacy_args="$_legacy_args --static"
                         ;;
@@ -808,7 +831,7 @@
         best_delegate=`find_best_delegate`
 
         if [ -n "$best_delegate" ]; then
-            
+
             if [ -n "$WXDEBUG" ]; then
                 decho "  found a suitable delegate: $best_delegate"
                 decho "--> $wxconfdir/$best_delegate $*"
@@ -988,7 +1011,7 @@
             match_field "$f" $_all_ldflags || _all_ldflags="$_all_ldflags $f"
         done
 
-        if match_field "$lib" @CORE_BASE_LIBS@ ; then
+        if match_field "$lib" @STD_BASE_LIBS@ ; then
             _libname="@WX_LIBRARY_BASENAME_NOGUI@"
         else
             _libname="@WX_LIBRARY_BASENAME_GUI@"
@@ -1047,7 +1070,7 @@
     is_cross && _target="-${target}"
 
     for lib do
-        if match_field "$lib" @CORE_BASE_LIBS@ ; then
+        if match_field "$lib" @STD_BASE_LIBS@ ; then
             _libname="@WX_LIBRARY_BASENAME_NOGUI@"
         else
             _libname="@WX_LIBRARY_BASENAME_GUI@"
@@ -1064,53 +1087,70 @@
 # Sanity check the list of libs the user provided us, if any.
 # --------------------------------------------------------------
 
-wx_libs=`echo "$input_parameters" | tr ',' ' '`
+wx_libs=`echo "$libs_parameters" | tr ',' ' '`
+wx_optional_libs=`echo "$optional_libs_parameters" | tr ',' ' '`
 
+# Add the --optional-libs, if they've been compiled and aren't already added
+for i in $wx_optional_libs; do
+    if match_field $i @BUILT_WX_LIBS@; then
+        if not match_field $i $wx_libs; then
+            wx_libs="${wx_libs:+$wx_libs }$i"
+        fi
+    fi
+done
+
 [ -z "$WXDEBUG" ] || decho "  user supplied libs: '$wx_libs'"
 
 if is_monolithic; then
 
-    # Core libs are already built into the blob.
-    for i in std @CORE_GUI_LIBS@ @CORE_BASE_LIBS@; do
-        wx_libs=`remove_field $i $wx_libs`
-    done
+    # Only add additional info if --libs was specified and not just --optional-libs
+    if [ -n "$output_option_libs" ]; then
+        # Core libs are already built into the blob.
+        for i in std @STD_GUI_LIBS@ @STD_BASE_LIBS@; do
+            wx_libs=`remove_field $i $wx_libs`
+        done
 
-    wx_libs="@WXCONFIG_LDFLAGS_GUI@ `lib_flags_for $wx_libs`"
+        wx_libs="@WXCONFIG_LDFLAGS_GUI@ `lib_flags_for $wx_libs`"
 
-    # We still need the core lib deps for a static build though
-    if is_static; then
-        link_deps="${libdir}/libwx_@TOOLCHAIN_NAME@.a" 
-        wx_libs="$wx_libs $link_deps $ldlibs_core $ldlibs_base"
-    else
-        wx_libs="$wx_libs -lwx_@TOOLCHAIN_NAME@"
+        # We still need the core lib deps for a static build though
+        if is_static; then
+            link_deps="${libdir}/libwx_@TOOLCHAIN_NAME@.a"
+            wx_libs="$wx_libs $link_deps $ldlibs_core $ldlibs_base"
+        else
+            wx_libs="$wx_libs -lwx_@TOOLCHAIN_NAME@"
+        fi
+
+        using_gui=yes
     fi
-
-    using_gui=yes
-
 else    # MONOLITHIC = 0
 
-    # Import everything by default, expand std if specified, or add base if omitted.
-    if [ -z "$wx_libs" ]; then
-        wx_libs="@CORE_GUI_LIBS@ @CORE_BASE_LIBS@"
+    # Import core libs by default, expand std if specified, or add base if omitted.
+    if [ -n "$output_option_libs" ] && [ -z "$libs_parameters" ]; then
+        wx_libs="@STD_GUI_LIBS@ @STD_BASE_LIBS@"
+    elif match_field all $wx_libs; then
+        wx_libs="@BUILT_WX_LIBS@"
     elif match_field std $wx_libs; then
         # Bubble any libs that were already specified to the end
         # of the list and ensure static linking order is retained.
         wx_libs=`remove_field std $wx_libs`
-        for i in @CORE_GUI_LIBS@ @CORE_BASE_LIBS@; do
+        for i in @STD_GUI_LIBS@ @STD_BASE_LIBS@; do
             wx_libs="`remove_field $i $wx_libs` $i"
         done
     elif not match_field base $wx_libs ; then
-        wx_libs="$wx_libs base"
+        # Only add base if --libs was specified and not just --optional-libs
+        if [ -n "$output_option_libs" ]; then
+            wx_libs="$wx_libs base"
+        fi
     fi
 
     using_gui=no
     for i in $wx_libs ; do
-        if match_field "$i" @CORE_GUI_LIBS@ ; then
+        if match_field "$i" @STD_GUI_LIBS@ ; then
             _guildflags="@WXCONFIG_LDFLAGS_GUI@"
             using_gui=yes
             break
         fi
-        match_field "$i" @CORE_BASE_LIBS@ || using_gui=yes
+        match_field "$i" @STD_BASE_LIBS@ || using_gui=yes
     done
 
     if is_static; then
@@ -1149,6 +1189,7 @@
 [ -z "$output_option_linkdeps" ] || echo $link_deps
 
 if [ -n "$output_option_libs" ]; then
+    # if --libs [--optional-libs] then output the full linker information
 
     is_cross                                    &&
         [ "x$libdir" = "x/usr/${target}/lib" ]  ||
@@ -1158,6 +1199,11 @@
     is_installed || [ -n "$flag_option_no_rpath" ] || _rpath="@WXCONFIG_RPATH@"
 
     echo $_ldflags "@LDFLAGS@" $_rpath $wx_libs "@DMALLOC_LIBS@"
+
+elif [ -n "$output_option_optional_libs" ]; then
+    # if only --optional-libs then output just the libs
+
+    echo $wx_libs
 fi
 
 

 	  	 
